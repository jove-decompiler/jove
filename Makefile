# this just obtains the directory this Makefile resides in
JOVE_ROOT_DIR := $(shell cd $(dir $(word $(words $(MAKEFILE_LIST)),$(MAKEFILE_LIST)));pwd)

_LLVM_DIR         := $(JOVE_ROOT_DIR)/third_party/llvm-project
_LLVM_INSTALL_DIR := $(_LLVM_DIR)/install

_LLVM_CONFIG := $(_LLVM_INSTALL_DIR)/bin/llvm-config
_LLVM_CC     := $(_LLVM_INSTALL_DIR)/bin/clang
_LLVM_CXX    := $(_LLVM_INSTALL_DIR)/bin/clang++

ARCH := $(subst i686,i386,$(shell uname -m))

#
# build flags
#
CXXFLAGS := -std=gnu++14 \
            -Wall \
            -Wno-macro-redefined \
            -Wno-shift-count-negative \
            -Wno-initializer-overrides \
            -fno-omit-frame-pointer \
            -fvisibility=hidden \
            -fexceptions \
            -fwrapv \
            -Ofast \
            -g \
            -I bin \
            -I include \
            -I lib \
            -I lib/arch/$(ARCH) \
            -I $(_LLVM_INSTALL_DIR)/include \
            -D___JOVE_ARCH_NAME=\"$(ARCH)\" \
            -D_GNU_SOURCE \
            -DBOOST_ICL_USE_STATIC_BOUNDED_INTERVALS

LDFLAGS := $(shell pkg-config --libs glib-2.0) \
           $(shell $(_LLVM_CONFIG) --ldflags --libs) \
           $(shell $(_LLVM_CONFIG) --system-libs) \
           -Wl,--no-undefined \
           -ldl \
           -pthread \
           -lboost_filesystem \
           -lboost_system \
           -lboost_serialization

#
# important directories
#
BINDIR := bin

#
# find tools
#
TOOLSRCDIR := tools
TOOLSRCS   := $(wildcard $(TOOLSRCDIR)/*.cpp)
TOOLS      := $(patsubst $(TOOLSRCDIR)/%.cpp,%,$(TOOLSRCS))
TOOLBINS   := $(foreach tool,$(TOOLS),$(BINDIR)/$(tool))
TOOLDEPS   := $(foreach tool,$(TOOLS),$(BINDIR)/$(tool).d)

#
# find utils
#
UTILSRCDIR := utils
UTILSRCS   := $(wildcard $(UTILSRCDIR)/*.cpp)
UTILS      := $(patsubst $(UTILSRCDIR)/%.cpp,%,$(UTILSRCS))
UTILBINS   := $(foreach util,$(UTILS),$(BINDIR)/$(util))
UTILDEPS   := $(foreach util,$(UTILS),$(BINDIR)/$(util).d)

JOVE_RT_SO     := libjove_rt.so
JOVE_RT_SONAME := $(JOVE_RT_SO).0
JOVE_RT        := $(BINDIR)/$(JOVE_RT_SONAME)

#
# TCG helpers (for each architecture)
#
x86_64_HELPERS := cc_compute_all cc_compute_c write_eflags read_eflags divb_AL idivb_AL divw_AX idivw_AX divl_EAX idivl_EAX divq_EAX idivq_EAX cr4_testbit bndck bndldx32 bndldx64 bndstx32 bndstx64 bnd_jmp aam aad aaa aas daa das lsl lar verr verw lldt ltr load_seg ljmp_protected lcall_real lcall_protected iret_real iret_protected lret_protected read_crN write_crN lmsw clts set_dr get_dr invlpg sysenter sysexit syscall sysret hlt monitor mwait pause debug reset_rf raise_interrupt raise_exception cli sti clac stac boundw boundl rsm into cmpxchg8b_unlocked cmpxchg8b cmpxchg16b_unlocked cmpxchg16b single_step rechecking_single_step cpuid rdtsc rdtscp rdpmc rdmsr wrmsr check_iob check_iow check_iol outb inb outw inw outl inl bpt_io svm_check_intercept_param svm_check_io vmrun vmmcall vmload vmsave stgi clgi skinit invlpga flds_FT0 fldl_FT0 fildl_FT0 flds_ST0 fldl_ST0 fildl_ST0 fildll_ST0 fsts_ST0 fstl_ST0 fist_ST0 fistl_ST0 fistll_ST0 fistt_ST0 fisttl_ST0 fisttll_ST0 fldt_ST0 fstt_ST0 fpush fpop fdecstp fincstp ffree_STN fmov_ST0_FT0 fmov_FT0_STN fmov_ST0_STN fmov_STN_ST0 fxchg_ST0_STN fcom_ST0_FT0 fucom_ST0_FT0 fcomi_ST0_FT0 fucomi_ST0_FT0 fadd_ST0_FT0 fmul_ST0_FT0 fsub_ST0_FT0 fsubr_ST0_FT0 fdiv_ST0_FT0 fdivr_ST0_FT0 fadd_STN_ST0 fmul_STN_ST0 fsub_STN_ST0 fsubr_STN_ST0 fdiv_STN_ST0 fdivr_STN_ST0 fchs_ST0 fabs_ST0 fxam_ST0 fld1_ST0 fldl2t_ST0 fldl2e_ST0 fldpi_ST0 fldlg2_ST0 fldln2_ST0 fldz_ST0 fldz_FT0 fnstsw fnstcw fldcw fclex fwait fninit fbld_ST0 fbst_ST0 f2xm1 fyl2x fptan fpatan fxtract fprem1 fprem fyl2xp1 fsqrt fsincos frndint fscale fsin fcos fstenv fldenv fsave frstor fxsave fxrstor xsave xsaveopt xrstor xgetbv xsetbv rdpkru wrpkru pdep pext ldmxcsr enter_mmx emms movq psrlw_mmx psraw_mmx psllw_mmx psrld_mmx psrad_mmx pslld_mmx psrlq_mmx psllq_mmx paddb_mmx paddw_mmx paddl_mmx paddq_mmx psubb_mmx psubw_mmx psubl_mmx psubq_mmx paddusb_mmx paddsb_mmx psubusb_mmx psubsb_mmx paddusw_mmx paddsw_mmx psubusw_mmx psubsw_mmx pminub_mmx pmaxub_mmx pminsw_mmx pmaxsw_mmx pand_mmx pandn_mmx por_mmx pxor_mmx pcmpgtb_mmx pcmpgtw_mmx pcmpgtl_mmx pcmpeqb_mmx pcmpeqw_mmx pcmpeql_mmx pmullw_mmx pmulhrw_mmx pmulhuw_mmx pmulhw_mmx pavgb_mmx pavgw_mmx pmuludq_mmx pmaddwd_mmx psadbw_mmx maskmov_mmx movl_mm_T0_mmx movq_mm_T0_mmx pshufw_mmx pmovmskb_mmx packsswb_mmx packuswb_mmx packssdw_mmx punpcklbw_mmx punpcklwd_mmx punpckldq_mmx punpckhbw_mmx punpckhwd_mmx punpckhdq_mmx pi2fd pi2fw pf2id pf2iw pfacc pfadd pfcmpeq pfcmpge pfcmpgt pfmax pfmin pfmul pfnacc pfpnacc pfrcp pfrsqrt pfsub pfsubr pswapd phaddw_mmx phaddd_mmx phaddsw_mmx phsubw_mmx phsubd_mmx phsubsw_mmx pabsb_mmx pabsw_mmx pabsd_mmx pmaddubsw_mmx pmulhrsw_mmx pshufb_mmx psignb_mmx psignw_mmx psignd_mmx palignr_mmx psrlw_xmm psraw_xmm psllw_xmm psrld_xmm psrad_xmm pslld_xmm psrlq_xmm psllq_xmm psrldq_xmm pslldq_xmm paddb_xmm paddw_xmm paddl_xmm paddq_xmm psubb_xmm psubw_xmm psubl_xmm psubq_xmm paddusb_xmm paddsb_xmm psubusb_xmm psubsb_xmm paddusw_xmm paddsw_xmm psubusw_xmm psubsw_xmm pminub_xmm pmaxub_xmm pminsw_xmm pmaxsw_xmm pand_xmm pandn_xmm por_xmm pxor_xmm pcmpgtb_xmm pcmpgtw_xmm pcmpgtl_xmm pcmpeqb_xmm pcmpeqw_xmm pcmpeql_xmm pmullw_xmm pmulhuw_xmm pmulhw_xmm pavgb_xmm pavgw_xmm pmuludq_xmm pmaddwd_xmm psadbw_xmm maskmov_xmm movl_mm_T0_xmm movq_mm_T0_xmm shufps shufpd pshufd_xmm pshuflw_xmm pshufhw_xmm addps addss addpd addsd subps subss subpd subsd mulps mulss mulpd mulsd divps divss divpd divsd minps minss minpd minsd maxps maxss maxpd maxsd sqrtps sqrtss sqrtpd sqrtsd cvtps2pd cvtpd2ps cvtss2sd cvtsd2ss cvtdq2ps cvtdq2pd cvtpi2ps cvtpi2pd cvtsi2ss cvtsi2sd cvtsq2ss cvtsq2sd cvtps2dq cvtpd2dq cvtps2pi cvtpd2pi cvtss2si cvtsd2si cvtss2sq cvtsd2sq cvttps2dq cvttpd2dq cvttps2pi cvttpd2pi cvttss2si cvttsd2si cvttss2sq cvttsd2sq rsqrtps rsqrtss rcpps rcpss extrq_r extrq_i insertq_r insertq_i haddps haddpd hsubps hsubpd addsubps addsubpd cmpeqps cmpeqss cmpeqpd cmpeqsd cmpltps cmpltss cmpltpd cmpltsd cmpleps cmpless cmplepd cmplesd cmpunordps cmpunordss cmpunordpd cmpunordsd cmpneqps cmpneqss cmpneqpd cmpneqsd cmpnltps cmpnltss cmpnltpd cmpnltsd cmpnleps cmpnless cmpnlepd cmpnlesd cmpordps cmpordss cmpordpd cmpordsd ucomiss comiss ucomisd comisd movmskps movmskpd pmovmskb_xmm packsswb_xmm packuswb_xmm packssdw_xmm punpcklbw_xmm punpcklwd_xmm punpckldq_xmm punpckhbw_xmm punpckhwd_xmm punpckhdq_xmm punpcklqdq_xmm punpckhqdq_xmm phaddw_xmm phaddd_xmm phaddsw_xmm phsubw_xmm phsubd_xmm phsubsw_xmm pabsb_xmm pabsw_xmm pabsd_xmm pmaddubsw_xmm pmulhrsw_xmm pshufb_xmm psignb_xmm psignw_xmm psignd_xmm palignr_xmm pblendvb_xmm blendvps_xmm blendvpd_xmm ptest_xmm pmovsxbw_xmm pmovsxbd_xmm pmovsxbq_xmm pmovsxwd_xmm pmovsxwq_xmm pmovsxdq_xmm pmovzxbw_xmm pmovzxbd_xmm pmovzxbq_xmm pmovzxwd_xmm pmovzxwq_xmm pmovzxdq_xmm pmuldq_xmm pcmpeqq_xmm packusdw_xmm pminsb_xmm pminsd_xmm pminuw_xmm pminud_xmm pmaxsb_xmm pmaxsd_xmm pmaxuw_xmm pmaxud_xmm pmulld_xmm phminposuw_xmm roundps_xmm roundpd_xmm roundss_xmm roundsd_xmm blendps_xmm blendpd_xmm pblendw_xmm dpps_xmm dppd_xmm mpsadbw_xmm pcmpgtq_xmm pcmpestri_xmm pcmpestrm_xmm pcmpistri_xmm pcmpistrm_xmm crc32 aesdec_xmm aesdeclast_xmm aesenc_xmm aesenclast_xmm aesimc_xmm aeskeygenassist_xmm pclmulqdq_xmm rclb rclw rcll rcrb rcrw rcrl rclq rcrq trace_guest_mem_before_exec_proxy div_i32 rem_i32 divu_i32 remu_i32 div_i64 rem_i64 divu_i64 remu_i64 shl_i64 shr_i64 sar_i64 mulsh_i64 muluh_i64 clz_i32 ctz_i32 clz_i64 ctz_i64 clrsb_i32 clrsb_i64 ctpop_i32 ctpop_i64 lookup_tb_ptr exit_atomic atomic_cmpxchgb atomic_cmpxchgw_be atomic_cmpxchgw_le atomic_cmpxchgl_be atomic_cmpxchgl_le atomic_cmpxchgq_be atomic_cmpxchgq_le atomic_fetch_addb atomic_fetch_addw_le atomic_fetch_addw_be atomic_fetch_addl_le atomic_fetch_addl_be atomic_fetch_addq_le atomic_fetch_addq_be atomic_fetch_andb atomic_fetch_andw_le atomic_fetch_andw_be atomic_fetch_andl_le atomic_fetch_andl_be atomic_fetch_andq_le atomic_fetch_andq_be atomic_fetch_orb atomic_fetch_orw_le atomic_fetch_orw_be atomic_fetch_orl_le atomic_fetch_orl_be atomic_fetch_orq_le atomic_fetch_orq_be atomic_fetch_xorb atomic_fetch_xorw_le atomic_fetch_xorw_be atomic_fetch_xorl_le atomic_fetch_xorl_be atomic_fetch_xorq_le atomic_fetch_xorq_be atomic_add_fetchb atomic_add_fetchw_le atomic_add_fetchw_be atomic_add_fetchl_le atomic_add_fetchl_be atomic_add_fetchq_le atomic_add_fetchq_be atomic_and_fetchb atomic_and_fetchw_le atomic_and_fetchw_be atomic_and_fetchl_le atomic_and_fetchl_be atomic_and_fetchq_le atomic_and_fetchq_be atomic_or_fetchb atomic_or_fetchw_le atomic_or_fetchw_be atomic_or_fetchl_le atomic_or_fetchl_be atomic_or_fetchq_le atomic_or_fetchq_be atomic_xor_fetchb atomic_xor_fetchw_le atomic_xor_fetchw_be atomic_xor_fetchl_le atomic_xor_fetchl_be atomic_xor_fetchq_le atomic_xor_fetchq_be atomic_xchgb atomic_xchgw_le atomic_xchgw_be atomic_xchgl_le atomic_xchgl_be atomic_xchgq_le atomic_xchgq_be gvec_mov gvec_dup8 gvec_dup16 gvec_dup32 gvec_dup64 gvec_add8 gvec_add16 gvec_add32 gvec_add64 gvec_adds8 gvec_adds16 gvec_adds32 gvec_adds64 gvec_sub8 gvec_sub16 gvec_sub32 gvec_sub64 gvec_subs8 gvec_subs16 gvec_subs32 gvec_subs64 gvec_mul8 gvec_mul16 gvec_mul32 gvec_mul64 gvec_muls8 gvec_muls16 gvec_muls32 gvec_muls64 gvec_ssadd8 gvec_ssadd16 gvec_ssadd32 gvec_ssadd64 gvec_sssub8 gvec_sssub16 gvec_sssub32 gvec_sssub64 gvec_usadd8 gvec_usadd16 gvec_usadd32 gvec_usadd64 gvec_ussub8 gvec_ussub16 gvec_ussub32 gvec_ussub64 gvec_neg8 gvec_neg16 gvec_neg32 gvec_neg64 gvec_not gvec_and gvec_or gvec_xor gvec_andc gvec_orc gvec_ands gvec_xors gvec_ors gvec_shl8i gvec_shl16i gvec_shl32i gvec_shl64i gvec_shr8i gvec_shr16i gvec_shr32i gvec_shr64i gvec_sar8i gvec_sar16i gvec_sar32i gvec_sar64i gvec_eq8 gvec_eq16 gvec_eq32 gvec_eq64 gvec_ne8 gvec_ne16 gvec_ne32 gvec_ne64 gvec_lt8 gvec_lt16 gvec_lt32 gvec_lt64 gvec_le8 gvec_le16 gvec_le32 gvec_le64 gvec_ltu8 gvec_ltu16 gvec_ltu32 gvec_ltu64 gvec_leu8 gvec_leu16 gvec_leu32 gvec_leu64

i386_HELPERS := cc_compute_all cc_compute_c write_eflags read_eflags divb_AL idivb_AL divw_AX idivw_AX divl_EAX idivl_EAX cr4_testbit bndck bndldx32 bndldx64 bndstx32 bndstx64 bnd_jmp aam aad aaa aas daa das lsl lar verr verw lldt ltr load_seg ljmp_protected lcall_real lcall_protected iret_real iret_protected lret_protected read_crN write_crN lmsw clts set_dr get_dr invlpg sysenter sysexit hlt monitor mwait pause debug reset_rf raise_interrupt raise_exception cli sti clac stac boundw boundl rsm into cmpxchg8b_unlocked cmpxchg8b single_step rechecking_single_step cpuid rdtsc rdtscp rdpmc rdmsr wrmsr check_iob check_iow check_iol outb inb outw inw outl inl bpt_io svm_check_intercept_param svm_check_io vmrun vmmcall vmload vmsave stgi clgi skinit invlpga flds_FT0 fldl_FT0 fildl_FT0 flds_ST0 fldl_ST0 fildl_ST0 fildll_ST0 fsts_ST0 fstl_ST0 fist_ST0 fistl_ST0 fistll_ST0 fistt_ST0 fisttl_ST0 fisttll_ST0 fldt_ST0 fstt_ST0 fpush fpop fdecstp fincstp ffree_STN fmov_ST0_FT0 fmov_FT0_STN fmov_ST0_STN fmov_STN_ST0 fxchg_ST0_STN fcom_ST0_FT0 fucom_ST0_FT0 fcomi_ST0_FT0 fucomi_ST0_FT0 fadd_ST0_FT0 fmul_ST0_FT0 fsub_ST0_FT0 fsubr_ST0_FT0 fdiv_ST0_FT0 fdivr_ST0_FT0 fadd_STN_ST0 fmul_STN_ST0 fsub_STN_ST0 fsubr_STN_ST0 fdiv_STN_ST0 fdivr_STN_ST0 fchs_ST0 fabs_ST0 fxam_ST0 fld1_ST0 fldl2t_ST0 fldl2e_ST0 fldpi_ST0 fldlg2_ST0 fldln2_ST0 fldz_ST0 fldz_FT0 fnstsw fnstcw fldcw fclex fwait fninit fbld_ST0 fbst_ST0 f2xm1 fyl2x fptan fpatan fxtract fprem1 fprem fyl2xp1 fsqrt fsincos frndint fscale fsin fcos fstenv fldenv fsave frstor fxsave fxrstor xsave xsaveopt xrstor xgetbv xsetbv rdpkru wrpkru pdep pext ldmxcsr enter_mmx emms movq psrlw_mmx psraw_mmx psllw_mmx psrld_mmx psrad_mmx pslld_mmx psrlq_mmx psllq_mmx paddb_mmx paddw_mmx paddl_mmx paddq_mmx psubb_mmx psubw_mmx psubl_mmx psubq_mmx paddusb_mmx paddsb_mmx psubusb_mmx psubsb_mmx paddusw_mmx paddsw_mmx psubusw_mmx psubsw_mmx pminub_mmx pmaxub_mmx pminsw_mmx pmaxsw_mmx pand_mmx pandn_mmx por_mmx pxor_mmx pcmpgtb_mmx pcmpgtw_mmx pcmpgtl_mmx pcmpeqb_mmx pcmpeqw_mmx pcmpeql_mmx pmullw_mmx pmulhrw_mmx pmulhuw_mmx pmulhw_mmx pavgb_mmx pavgw_mmx pmuludq_mmx pmaddwd_mmx psadbw_mmx maskmov_mmx movl_mm_T0_mmx pshufw_mmx pmovmskb_mmx packsswb_mmx packuswb_mmx packssdw_mmx punpcklbw_mmx punpcklwd_mmx punpckldq_mmx punpckhbw_mmx punpckhwd_mmx punpckhdq_mmx pi2fd pi2fw pf2id pf2iw pfacc pfadd pfcmpeq pfcmpge pfcmpgt pfmax pfmin pfmul pfnacc pfpnacc pfrcp pfrsqrt pfsub pfsubr pswapd phaddw_mmx phaddd_mmx phaddsw_mmx phsubw_mmx phsubd_mmx phsubsw_mmx pabsb_mmx pabsw_mmx pabsd_mmx pmaddubsw_mmx pmulhrsw_mmx pshufb_mmx psignb_mmx psignw_mmx psignd_mmx palignr_mmx psrlw_xmm psraw_xmm psllw_xmm psrld_xmm psrad_xmm pslld_xmm psrlq_xmm psllq_xmm psrldq_xmm pslldq_xmm paddb_xmm paddw_xmm paddl_xmm paddq_xmm psubb_xmm psubw_xmm psubl_xmm psubq_xmm paddusb_xmm paddsb_xmm psubusb_xmm psubsb_xmm paddusw_xmm paddsw_xmm psubusw_xmm psubsw_xmm pminub_xmm pmaxub_xmm pminsw_xmm pmaxsw_xmm pand_xmm pandn_xmm por_xmm pxor_xmm pcmpgtb_xmm pcmpgtw_xmm pcmpgtl_xmm pcmpeqb_xmm pcmpeqw_xmm pcmpeql_xmm pmullw_xmm pmulhuw_xmm pmulhw_xmm pavgb_xmm pavgw_xmm pmuludq_xmm pmaddwd_xmm psadbw_xmm maskmov_xmm movl_mm_T0_xmm shufps shufpd pshufd_xmm pshuflw_xmm pshufhw_xmm addps addss addpd addsd subps subss subpd subsd mulps mulss mulpd mulsd divps divss divpd divsd minps minss minpd minsd maxps maxss maxpd maxsd sqrtps sqrtss sqrtpd sqrtsd cvtps2pd cvtpd2ps cvtss2sd cvtsd2ss cvtdq2ps cvtdq2pd cvtpi2ps cvtpi2pd cvtsi2ss cvtsi2sd cvtps2dq cvtpd2dq cvtps2pi cvtpd2pi cvtss2si cvtsd2si cvttps2dq cvttpd2dq cvttps2pi cvttpd2pi cvttss2si cvttsd2si rsqrtps rsqrtss rcpps rcpss extrq_r extrq_i insertq_r insertq_i haddps haddpd hsubps hsubpd addsubps addsubpd cmpeqps cmpeqss cmpeqpd cmpeqsd cmpltps cmpltss cmpltpd cmpltsd cmpleps cmpless cmplepd cmplesd cmpunordps cmpunordss cmpunordpd cmpunordsd cmpneqps cmpneqss cmpneqpd cmpneqsd cmpnltps cmpnltss cmpnltpd cmpnltsd cmpnleps cmpnless cmpnlepd cmpnlesd cmpordps cmpordss cmpordpd cmpordsd ucomiss comiss ucomisd comisd movmskps movmskpd pmovmskb_xmm packsswb_xmm packuswb_xmm packssdw_xmm punpcklbw_xmm punpcklwd_xmm punpckldq_xmm punpckhbw_xmm punpckhwd_xmm punpckhdq_xmm punpcklqdq_xmm punpckhqdq_xmm phaddw_xmm phaddd_xmm phaddsw_xmm phsubw_xmm phsubd_xmm phsubsw_xmm pabsb_xmm pabsw_xmm pabsd_xmm pmaddubsw_xmm pmulhrsw_xmm pshufb_xmm psignb_xmm psignw_xmm psignd_xmm palignr_xmm pblendvb_xmm blendvps_xmm blendvpd_xmm ptest_xmm pmovsxbw_xmm pmovsxbd_xmm pmovsxbq_xmm pmovsxwd_xmm pmovsxwq_xmm pmovsxdq_xmm pmovzxbw_xmm pmovzxbd_xmm pmovzxbq_xmm pmovzxwd_xmm pmovzxwq_xmm pmovzxdq_xmm pmuldq_xmm pcmpeqq_xmm packusdw_xmm pminsb_xmm pminsd_xmm pminuw_xmm pminud_xmm pmaxsb_xmm pmaxsd_xmm pmaxuw_xmm pmaxud_xmm pmulld_xmm phminposuw_xmm roundps_xmm roundpd_xmm roundss_xmm roundsd_xmm blendps_xmm blendpd_xmm pblendw_xmm dpps_xmm dppd_xmm mpsadbw_xmm pcmpgtq_xmm pcmpestri_xmm pcmpestrm_xmm pcmpistri_xmm pcmpistrm_xmm crc32 aesdec_xmm aesdeclast_xmm aesenc_xmm aesenclast_xmm aesimc_xmm aeskeygenassist_xmm pclmulqdq_xmm rclb rclw rcll rcrb rcrw rcrl trace_guest_mem_before_exec_proxy div_i32 rem_i32 divu_i32 remu_i32 div_i64 rem_i64 divu_i64 remu_i64 shl_i64 shr_i64 sar_i64 mulsh_i64 muluh_i64 clz_i32 ctz_i32 clz_i64 ctz_i64 clrsb_i32 clrsb_i64 ctpop_i32 ctpop_i64 lookup_tb_ptr exit_atomic atomic_cmpxchgb atomic_cmpxchgw_be atomic_cmpxchgw_le atomic_cmpxchgl_be atomic_cmpxchgl_le atomic_fetch_addb atomic_fetch_addw_le atomic_fetch_addw_be atomic_fetch_addl_le atomic_fetch_addl_be atomic_fetch_andb atomic_fetch_andw_le atomic_fetch_andw_be atomic_fetch_andl_le atomic_fetch_andl_be atomic_fetch_orb atomic_fetch_orw_le atomic_fetch_orw_be atomic_fetch_orl_le atomic_fetch_orl_be atomic_fetch_xorb atomic_fetch_xorw_le atomic_fetch_xorw_be atomic_fetch_xorl_le atomic_fetch_xorl_be atomic_add_fetchb atomic_add_fetchw_le atomic_add_fetchw_be atomic_add_fetchl_le atomic_add_fetchl_be atomic_and_fetchb atomic_and_fetchw_le atomic_and_fetchw_be atomic_and_fetchl_le atomic_and_fetchl_be atomic_or_fetchb atomic_or_fetchw_le atomic_or_fetchw_be atomic_or_fetchl_le atomic_or_fetchl_be atomic_xor_fetchb atomic_xor_fetchw_le atomic_xor_fetchw_be atomic_xor_fetchl_le atomic_xor_fetchl_be atomic_xchgb atomic_xchgw_le atomic_xchgw_be atomic_xchgl_le atomic_xchgl_be gvec_mov gvec_dup8 gvec_dup16 gvec_dup32 gvec_dup64 gvec_add8 gvec_add16 gvec_add32 gvec_add64 gvec_adds8 gvec_adds16 gvec_adds32 gvec_adds64 gvec_sub8 gvec_sub16 gvec_sub32 gvec_sub64 gvec_subs8 gvec_subs16 gvec_subs32 gvec_subs64 gvec_mul8 gvec_mul16 gvec_mul32 gvec_mul64 gvec_muls8 gvec_muls16 gvec_muls32 gvec_muls64 gvec_ssadd8 gvec_ssadd16 gvec_ssadd32 gvec_ssadd64 gvec_sssub8 gvec_sssub16 gvec_sssub32 gvec_sssub64 gvec_usadd8 gvec_usadd16 gvec_usadd32 gvec_usadd64 gvec_ussub8 gvec_ussub16 gvec_ussub32 gvec_ussub64 gvec_neg8 gvec_neg16 gvec_neg32 gvec_neg64 gvec_not gvec_and gvec_or gvec_xor gvec_andc gvec_orc gvec_ands gvec_xors gvec_ors gvec_shl8i gvec_shl16i gvec_shl32i gvec_shl64i gvec_shr8i gvec_shr16i gvec_shr32i gvec_shr64i gvec_sar8i gvec_sar16i gvec_sar32i gvec_sar64i gvec_eq8 gvec_eq16 gvec_eq32 gvec_eq64 gvec_ne8 gvec_ne16 gvec_ne32 gvec_ne64 gvec_lt8 gvec_lt16 gvec_lt32 gvec_lt64 gvec_le8 gvec_le16 gvec_le32 gvec_le64 gvec_ltu8 gvec_ltu16 gvec_ltu32 gvec_ltu64 gvec_leu8 gvec_leu16 gvec_leu32 gvec_leu64

aarch64_HELPERS := sxtb16 uxtb16 add_setq add_saturate sub_saturate add_usaturate sub_usaturate sdiv udiv rbit sadd8 ssub8 ssub16 sadd16 saddsubx ssubaddx uadd8 usub8 usub16 uadd16 uaddsubx usubaddx qadd8 qsub8 qsub16 qadd16 qaddsubx qsubaddx shadd8 shsub8 shsub16 shadd16 shaddsubx shsubaddx uqadd8 uqsub8 uqsub16 uqadd16 uqaddsubx uqsubaddx uhadd8 uhsub8 uhsub16 uhadd16 uhaddsubx uhsubaddx ssat usat ssat16 usat16 usad8 sel_flags exception_internal exception_with_syndrome exception_bkpt_insn setend wfi wfe yield pre_hvc pre_smc check_breakpoints cpsr_write cpsr_write_eret cpsr_read v7m_msr v7m_mrs v7m_bxns v7m_blxns v7m_tt v7m_preserve_fp_state v7m_vlstm v7m_vlldm v8m_stackcheck access_check_cp_reg set_cp_reg get_cp_reg set_cp_reg64 get_cp_reg64 get_r13_banked set_r13_banked mrs_banked msr_banked get_user_reg set_user_reg rebuild_hflags_m32 rebuild_hflags_a32 rebuild_hflags_a64 vfp_get_fpscr vfp_set_fpscr vfp_adds vfp_addd vfp_subs vfp_subd vfp_muls vfp_muld vfp_divs vfp_divd vfp_maxs vfp_maxd vfp_mins vfp_mind vfp_maxnums vfp_maxnumd vfp_minnums vfp_minnumd vfp_negs vfp_negd vfp_abss vfp_absd vfp_sqrts vfp_sqrtd vfp_cmps vfp_cmpd vfp_cmpes vfp_cmped vfp_fcvtds vfp_fcvtsd vfp_uitoh vfp_uitos vfp_uitod vfp_sitoh vfp_sitos vfp_sitod vfp_touih vfp_touis vfp_touid vfp_touizh vfp_touizs vfp_touizd vfp_tosih vfp_tosis vfp_tosid vfp_tosizh vfp_tosizs vfp_tosizd vfp_toshs_round_to_zero vfp_tosls_round_to_zero vfp_touhs_round_to_zero vfp_touls_round_to_zero vfp_toshd_round_to_zero vfp_tosld_round_to_zero vfp_touhd_round_to_zero vfp_tould_round_to_zero vfp_touhh vfp_toshh vfp_toulh vfp_toslh vfp_touqh vfp_tosqh vfp_toshs vfp_tosls vfp_tosqs vfp_touhs vfp_touls vfp_touqs vfp_toshd vfp_tosld vfp_tosqd vfp_touhd vfp_tould vfp_touqd vfp_shtos vfp_sltos vfp_sqtos vfp_uhtos vfp_ultos vfp_uqtos vfp_shtod vfp_sltod vfp_sqtod vfp_uhtod vfp_ultod vfp_uqtod vfp_sltoh vfp_ultoh vfp_sqtoh vfp_uqtoh set_rmode set_neon_rmode vfp_fcvt_f16_to_f32 vfp_fcvt_f32_to_f16 vfp_fcvt_f16_to_f64 vfp_fcvt_f64_to_f16 vfp_muladdd vfp_muladds recps_f32 rsqrts_f32 recpe_f16 recpe_f32 recpe_f64 rsqrte_f16 rsqrte_f32 rsqrte_f64 recpe_u32 rsqrte_u32 neon_tbl shl_cc shr_cc sar_cc ror_cc rints_exact rintd_exact rints rintd vjcvt fjcvtzs neon_qadd_u8 neon_qadd_s8 neon_qadd_u16 neon_qadd_s16 neon_qadd_u32 neon_qadd_s32 neon_uqadd_s8 neon_uqadd_s16 neon_uqadd_s32 neon_uqadd_s64 neon_sqadd_u8 neon_sqadd_u16 neon_sqadd_u32 neon_sqadd_u64 neon_qsub_u8 neon_qsub_s8 neon_qsub_u16 neon_qsub_s16 neon_qsub_u32 neon_qsub_s32 neon_qadd_u64 neon_qadd_s64 neon_qsub_u64 neon_qsub_s64 neon_hadd_s8 neon_hadd_u8 neon_hadd_s16 neon_hadd_u16 neon_hadd_s32 neon_hadd_u32 neon_rhadd_s8 neon_rhadd_u8 neon_rhadd_s16 neon_rhadd_u16 neon_rhadd_s32 neon_rhadd_u32 neon_hsub_s8 neon_hsub_u8 neon_hsub_s16 neon_hsub_u16 neon_hsub_s32 neon_hsub_u32 neon_cgt_u8 neon_cgt_s8 neon_cgt_u16 neon_cgt_s16 neon_cgt_u32 neon_cgt_s32 neon_cge_u8 neon_cge_s8 neon_cge_u16 neon_cge_s16 neon_cge_u32 neon_cge_s32 neon_pmin_u8 neon_pmin_s8 neon_pmin_u16 neon_pmin_s16 neon_pmax_u8 neon_pmax_s8 neon_pmax_u16 neon_pmax_s16 neon_abd_u8 neon_abd_s8 neon_abd_u16 neon_abd_s16 neon_abd_u32 neon_abd_s32 neon_shl_u8 neon_shl_s8 neon_shl_u16 neon_shl_s16 neon_shl_u32 neon_shl_s32 neon_shl_u64 neon_shl_s64 neon_rshl_u8 neon_rshl_s8 neon_rshl_u16 neon_rshl_s16 neon_rshl_u32 neon_rshl_s32 neon_rshl_u64 neon_rshl_s64 neon_qshl_u8 neon_qshl_s8 neon_qshl_u16 neon_qshl_s16 neon_qshl_u32 neon_qshl_s32 neon_qshl_u64 neon_qshl_s64 neon_qshlu_s8 neon_qshlu_s16 neon_qshlu_s32 neon_qshlu_s64 neon_qrshl_u8 neon_qrshl_s8 neon_qrshl_u16 neon_qrshl_s16 neon_qrshl_u32 neon_qrshl_s32 neon_qrshl_u64 neon_qrshl_s64 neon_add_u8 neon_add_u16 neon_padd_u8 neon_padd_u16 neon_sub_u8 neon_sub_u16 neon_mul_u8 neon_mul_u16 neon_mul_p8 neon_mull_p8 neon_tst_u8 neon_tst_u16 neon_tst_u32 neon_ceq_u8 neon_ceq_u16 neon_ceq_u32 neon_clz_u8 neon_clz_u16 neon_cls_s8 neon_cls_s16 neon_cls_s32 neon_cnt_u8 neon_rbit_u8 neon_qdmulh_s16 neon_qrdmulh_s16 neon_qrdmlah_s16 neon_qrdmlsh_s16 neon_qdmulh_s32 neon_qrdmulh_s32 neon_qrdmlah_s32 neon_qrdmlsh_s32 neon_narrow_u8 neon_narrow_u16 neon_unarrow_sat8 neon_narrow_sat_u8 neon_narrow_sat_s8 neon_unarrow_sat16 neon_narrow_sat_u16 neon_narrow_sat_s16 neon_unarrow_sat32 neon_narrow_sat_u32 neon_narrow_sat_s32 neon_narrow_high_u8 neon_narrow_high_u16 neon_narrow_round_high_u8 neon_narrow_round_high_u16 neon_widen_u8 neon_widen_s8 neon_widen_u16 neon_widen_s16 neon_addl_u16 neon_addl_u32 neon_paddl_u16 neon_paddl_u32 neon_subl_u16 neon_subl_u32 neon_addl_saturate_s32 neon_addl_saturate_s64 neon_abdl_u16 neon_abdl_s16 neon_abdl_u32 neon_abdl_s32 neon_abdl_u64 neon_abdl_s64 neon_mull_u8 neon_mull_s8 neon_mull_u16 neon_mull_s16 neon_negl_u16 neon_negl_u32 neon_qabs_s8 neon_qabs_s16 neon_qabs_s32 neon_qabs_s64 neon_qneg_s8 neon_qneg_s16 neon_qneg_s32 neon_qneg_s64 neon_abd_f32 neon_ceq_f32 neon_cge_f32 neon_cgt_f32 neon_acge_f32 neon_acgt_f32 neon_acge_f64 neon_acgt_f64 iwmmxt_maddsq iwmmxt_madduq iwmmxt_sadb iwmmxt_sadw iwmmxt_mulslw iwmmxt_mulshw iwmmxt_mululw iwmmxt_muluhw iwmmxt_macsw iwmmxt_macuw iwmmxt_setpsr_nz iwmmxt_unpacklb iwmmxt_unpacklw iwmmxt_unpackll iwmmxt_unpackhb iwmmxt_unpackhw iwmmxt_unpackhl iwmmxt_unpacklub iwmmxt_unpackluw iwmmxt_unpacklul iwmmxt_unpackhub iwmmxt_unpackhuw iwmmxt_unpackhul iwmmxt_unpacklsb iwmmxt_unpacklsw iwmmxt_unpacklsl iwmmxt_unpackhsb iwmmxt_unpackhsw iwmmxt_unpackhsl iwmmxt_cmpeqb iwmmxt_cmpeqw iwmmxt_cmpeql iwmmxt_cmpgtub iwmmxt_cmpgtuw iwmmxt_cmpgtul iwmmxt_cmpgtsb iwmmxt_cmpgtsw iwmmxt_cmpgtsl iwmmxt_minsb iwmmxt_minsw iwmmxt_minsl iwmmxt_minub iwmmxt_minuw iwmmxt_minul iwmmxt_maxsb iwmmxt_maxsw iwmmxt_maxsl iwmmxt_maxub iwmmxt_maxuw iwmmxt_maxul iwmmxt_subnb iwmmxt_subnw iwmmxt_subnl iwmmxt_addnb iwmmxt_addnw iwmmxt_addnl iwmmxt_subub iwmmxt_subuw iwmmxt_subul iwmmxt_addub iwmmxt_adduw iwmmxt_addul iwmmxt_subsb iwmmxt_subsw iwmmxt_subsl iwmmxt_addsb iwmmxt_addsw iwmmxt_addsl iwmmxt_avgb0 iwmmxt_avgb1 iwmmxt_avgw0 iwmmxt_avgw1 iwmmxt_align iwmmxt_insr iwmmxt_bcstb iwmmxt_bcstw iwmmxt_bcstl iwmmxt_addcb iwmmxt_addcw iwmmxt_addcl iwmmxt_msbb iwmmxt_msbw iwmmxt_msbl iwmmxt_srlw iwmmxt_srll iwmmxt_srlq iwmmxt_sllw iwmmxt_slll iwmmxt_sllq iwmmxt_sraw iwmmxt_sral iwmmxt_sraq iwmmxt_rorw iwmmxt_rorl iwmmxt_rorq iwmmxt_shufh iwmmxt_packuw iwmmxt_packul iwmmxt_packuq iwmmxt_packsw iwmmxt_packsl iwmmxt_packsq iwmmxt_muladdsl iwmmxt_muladdsw iwmmxt_muladdswl neon_unzip8 neon_unzip16 neon_qunzip8 neon_qunzip16 neon_qunzip32 neon_zip8 neon_zip16 neon_qzip8 neon_qzip16 neon_qzip32 crypto_aese crypto_aesmc crypto_sha1_3reg crypto_sha1h crypto_sha1su1 crypto_sha256h crypto_sha256h2 crypto_sha256su0 crypto_sha256su1 crypto_sha512h crypto_sha512h2 crypto_sha512su0 crypto_sha512su1 crypto_sm3tt crypto_sm3partw1 crypto_sm3partw2 crypto_sm4e crypto_sm4ekey crc32 crc32c dc_zva neon_pmull_64_lo neon_pmull_64_hi gvec_qrdmlah_s16 gvec_qrdmlsh_s16 gvec_qrdmlah_s32 gvec_qrdmlsh_s32 gvec_sdot_b gvec_udot_b gvec_sdot_h gvec_udot_h gvec_sdot_idx_b gvec_udot_idx_b gvec_sdot_idx_h gvec_udot_idx_h gvec_fcaddh gvec_fcadds gvec_fcaddd gvec_fcmlah gvec_fcmlah_idx gvec_fcmlas gvec_fcmlas_idx gvec_fcmlad gvec_frecpe_h gvec_frecpe_s gvec_frecpe_d gvec_frsqrte_h gvec_frsqrte_s gvec_frsqrte_d gvec_fadd_h gvec_fadd_s gvec_fadd_d gvec_fsub_h gvec_fsub_s gvec_fsub_d gvec_fmul_h gvec_fmul_s gvec_fmul_d gvec_ftsmul_h gvec_ftsmul_s gvec_ftsmul_d gvec_fmul_idx_h gvec_fmul_idx_s gvec_fmul_idx_d gvec_fmla_idx_h gvec_fmla_idx_s gvec_fmla_idx_d gvec_uqadd_b gvec_uqadd_h gvec_uqadd_s gvec_uqadd_d gvec_sqadd_b gvec_sqadd_h gvec_sqadd_s gvec_sqadd_d gvec_uqsub_b gvec_uqsub_h gvec_uqsub_s gvec_uqsub_d gvec_sqsub_b gvec_sqsub_h gvec_sqsub_s gvec_sqsub_d gvec_fmlal_a32 gvec_fmlal_a64 gvec_fmlal_idx_a32 gvec_fmlal_idx_a64 frint32_s frint64_s frint32_d frint64_d udiv64 sdiv64 rbit64 msr_i_spsel msr_i_daifset msr_i_daifclear vfp_cmph_a64 vfp_cmpeh_a64 vfp_cmps_a64 vfp_cmpes_a64 vfp_cmpd_a64 vfp_cmped_a64 simd_tbl vfp_mulxs vfp_mulxd neon_ceq_f64 neon_cge_f64 neon_cgt_f64 recpsf_f16 recpsf_f32 recpsf_f64 rsqrtsf_f16 rsqrtsf_f32 rsqrtsf_f64 neon_addlp_s8 neon_addlp_u8 neon_addlp_s16 neon_addlp_u16 frecpx_f64 frecpx_f32 frecpx_f16 fcvtx_f64_to_f32 crc32_64 crc32c_64 paired_cmpxchg64_le paired_cmpxchg64_le_parallel paired_cmpxchg64_be paired_cmpxchg64_be_parallel casp_le_parallel casp_be_parallel advsimd_maxh advsimd_minh advsimd_maxnumh advsimd_minnumh advsimd_addh advsimd_subh advsimd_mulh advsimd_divh advsimd_ceq_f16 advsimd_cge_f16 advsimd_cgt_f16 advsimd_acge_f16 advsimd_acgt_f16 advsimd_mulxh advsimd_muladdh advsimd_add2h advsimd_sub2h advsimd_mul2h advsimd_div2h advsimd_max2h advsimd_min2h advsimd_maxnum2h advsimd_minnum2h advsimd_mulx2h advsimd_muladd2h advsimd_rinth_exact advsimd_rinth advsimd_f16tosinth advsimd_f16touinth sqrt_f16 exception_return pacia pacib pacda pacdb pacga autia autib autda autdb xpaci xpacd sve_predtest1 sve_predtest sve_pfirst sve_pnext sve_and_zpzz_b sve_and_zpzz_h sve_and_zpzz_s sve_and_zpzz_d sve_eor_zpzz_b sve_eor_zpzz_h sve_eor_zpzz_s sve_eor_zpzz_d sve_orr_zpzz_b sve_orr_zpzz_h sve_orr_zpzz_s sve_orr_zpzz_d sve_bic_zpzz_b sve_bic_zpzz_h sve_bic_zpzz_s sve_bic_zpzz_d sve_add_zpzz_b sve_add_zpzz_h sve_add_zpzz_s sve_add_zpzz_d sve_sub_zpzz_b sve_sub_zpzz_h sve_sub_zpzz_s sve_sub_zpzz_d sve_smax_zpzz_b sve_smax_zpzz_h sve_smax_zpzz_s sve_smax_zpzz_d sve_umax_zpzz_b sve_umax_zpzz_h sve_umax_zpzz_s sve_umax_zpzz_d sve_smin_zpzz_b sve_smin_zpzz_h sve_smin_zpzz_s sve_smin_zpzz_d sve_umin_zpzz_b sve_umin_zpzz_h sve_umin_zpzz_s sve_umin_zpzz_d sve_sabd_zpzz_b sve_sabd_zpzz_h sve_sabd_zpzz_s sve_sabd_zpzz_d sve_uabd_zpzz_b sve_uabd_zpzz_h sve_uabd_zpzz_s sve_uabd_zpzz_d sve_mul_zpzz_b sve_mul_zpzz_h sve_mul_zpzz_s sve_mul_zpzz_d sve_smulh_zpzz_b sve_smulh_zpzz_h sve_smulh_zpzz_s sve_smulh_zpzz_d sve_umulh_zpzz_b sve_umulh_zpzz_h sve_umulh_zpzz_s sve_umulh_zpzz_d sve_sdiv_zpzz_s sve_sdiv_zpzz_d sve_udiv_zpzz_s sve_udiv_zpzz_d sve_asr_zpzz_b sve_asr_zpzz_h sve_asr_zpzz_s sve_asr_zpzz_d sve_lsr_zpzz_b sve_lsr_zpzz_h sve_lsr_zpzz_s sve_lsr_zpzz_d sve_lsl_zpzz_b sve_lsl_zpzz_h sve_lsl_zpzz_s sve_lsl_zpzz_d sve_sel_zpzz_b sve_sel_zpzz_h sve_sel_zpzz_s sve_sel_zpzz_d sve_asr_zpzw_b sve_asr_zpzw_h sve_asr_zpzw_s sve_lsr_zpzw_b sve_lsr_zpzw_h sve_lsr_zpzw_s sve_lsl_zpzw_b sve_lsl_zpzw_h sve_lsl_zpzw_s sve_orv_b sve_orv_h sve_orv_s sve_orv_d sve_eorv_b sve_eorv_h sve_eorv_s sve_eorv_d sve_andv_b sve_andv_h sve_andv_s sve_andv_d sve_saddv_b sve_saddv_h sve_saddv_s sve_uaddv_b sve_uaddv_h sve_uaddv_s sve_uaddv_d sve_smaxv_b sve_smaxv_h sve_smaxv_s sve_smaxv_d sve_umaxv_b sve_umaxv_h sve_umaxv_s sve_umaxv_d sve_sminv_b sve_sminv_h sve_sminv_s sve_sminv_d sve_uminv_b sve_uminv_h sve_uminv_s sve_uminv_d sve_clr_b sve_clr_h sve_clr_s sve_clr_d sve_movz_b sve_movz_h sve_movz_s sve_movz_d sve_asr_zpzi_b sve_asr_zpzi_h sve_asr_zpzi_s sve_asr_zpzi_d sve_lsr_zpzi_b sve_lsr_zpzi_h sve_lsr_zpzi_s sve_lsr_zpzi_d sve_lsl_zpzi_b sve_lsl_zpzi_h sve_lsl_zpzi_s sve_lsl_zpzi_d sve_asrd_b sve_asrd_h sve_asrd_s sve_asrd_d sve_cls_b sve_cls_h sve_cls_s sve_cls_d sve_clz_b sve_clz_h sve_clz_s sve_clz_d sve_cnt_zpz_b sve_cnt_zpz_h sve_cnt_zpz_s sve_cnt_zpz_d sve_cnot_b sve_cnot_h sve_cnot_s sve_cnot_d sve_fabs_h sve_fabs_s sve_fabs_d sve_fneg_h sve_fneg_s sve_fneg_d sve_not_zpz_b sve_not_zpz_h sve_not_zpz_s sve_not_zpz_d sve_sxtb_h sve_sxtb_s sve_sxtb_d sve_uxtb_h sve_uxtb_s sve_uxtb_d sve_sxth_s sve_sxth_d sve_uxth_s sve_uxth_d sve_sxtw_d sve_uxtw_d sve_abs_b sve_abs_h sve_abs_s sve_abs_d sve_neg_b sve_neg_h sve_neg_s sve_neg_d sve_mla_b sve_mla_h sve_mla_s sve_mla_d sve_mls_b sve_mls_h sve_mls_s sve_mls_d sve_index_b sve_index_h sve_index_s sve_index_d sve_asr_zzw_b sve_asr_zzw_h sve_asr_zzw_s sve_lsr_zzw_b sve_lsr_zzw_h sve_lsr_zzw_s sve_lsl_zzw_b sve_lsl_zzw_h sve_lsl_zzw_s sve_adr_p32 sve_adr_p64 sve_adr_s32 sve_adr_u32 sve_fexpa_h sve_fexpa_s sve_fexpa_d sve_ftssel_h sve_ftssel_s sve_ftssel_d sve_sqaddi_b sve_sqaddi_h sve_sqaddi_s sve_sqaddi_d sve_uqaddi_b sve_uqaddi_h sve_uqaddi_s sve_uqaddi_d sve_uqsubi_d sve_cpy_m_b sve_cpy_m_h sve_cpy_m_s sve_cpy_m_d sve_cpy_z_b sve_cpy_z_h sve_cpy_z_s sve_cpy_z_d sve_ext sve_insr_b sve_insr_h sve_insr_s sve_insr_d sve_rev_b sve_rev_h sve_rev_s sve_rev_d sve_tbl_b sve_tbl_h sve_tbl_s sve_tbl_d sve_sunpk_h sve_sunpk_s sve_sunpk_d sve_uunpk_h sve_uunpk_s sve_uunpk_d sve_zip_p sve_uzp_p sve_trn_p sve_rev_p sve_punpk_p sve_zip_b sve_zip_h sve_zip_s sve_zip_d sve_uzp_b sve_uzp_h sve_uzp_s sve_uzp_d sve_trn_b sve_trn_h sve_trn_s sve_trn_d sve_compact_s sve_compact_d sve_last_active_element sve_revb_h sve_revb_s sve_revb_d sve_revh_s sve_revh_d sve_revw_d sve_rbit_b sve_rbit_h sve_rbit_s sve_rbit_d sve_splice sve_cmpeq_ppzz_b sve_cmpne_ppzz_b sve_cmpge_ppzz_b sve_cmpgt_ppzz_b sve_cmphi_ppzz_b sve_cmphs_ppzz_b sve_cmpeq_ppzz_h sve_cmpne_ppzz_h sve_cmpge_ppzz_h sve_cmpgt_ppzz_h sve_cmphi_ppzz_h sve_cmphs_ppzz_h sve_cmpeq_ppzz_s sve_cmpne_ppzz_s sve_cmpge_ppzz_s sve_cmpgt_ppzz_s sve_cmphi_ppzz_s sve_cmphs_ppzz_s sve_cmpeq_ppzz_d sve_cmpne_ppzz_d sve_cmpge_ppzz_d sve_cmpgt_ppzz_d sve_cmphi_ppzz_d sve_cmphs_ppzz_d sve_cmpeq_ppzw_b sve_cmpne_ppzw_b sve_cmpge_ppzw_b sve_cmpgt_ppzw_b sve_cmphi_ppzw_b sve_cmphs_ppzw_b sve_cmple_ppzw_b sve_cmplt_ppzw_b sve_cmplo_ppzw_b sve_cmpls_ppzw_b sve_cmpeq_ppzw_h sve_cmpne_ppzw_h sve_cmpge_ppzw_h sve_cmpgt_ppzw_h sve_cmphi_ppzw_h sve_cmphs_ppzw_h sve_cmple_ppzw_h sve_cmplt_ppzw_h sve_cmplo_ppzw_h sve_cmpls_ppzw_h sve_cmpeq_ppzw_s sve_cmpne_ppzw_s sve_cmpge_ppzw_s sve_cmpgt_ppzw_s sve_cmphi_ppzw_s sve_cmphs_ppzw_s sve_cmple_ppzw_s sve_cmplt_ppzw_s sve_cmplo_ppzw_s sve_cmpls_ppzw_s sve_cmpeq_ppzi_b sve_cmpne_ppzi_b sve_cmpgt_ppzi_b sve_cmpge_ppzi_b sve_cmplt_ppzi_b sve_cmple_ppzi_b sve_cmphs_ppzi_b sve_cmphi_ppzi_b sve_cmplo_ppzi_b sve_cmpls_ppzi_b sve_cmpeq_ppzi_h sve_cmpne_ppzi_h sve_cmpgt_ppzi_h sve_cmpge_ppzi_h sve_cmplt_ppzi_h sve_cmple_ppzi_h sve_cmphs_ppzi_h sve_cmphi_ppzi_h sve_cmplo_ppzi_h sve_cmpls_ppzi_h sve_cmpeq_ppzi_s sve_cmpne_ppzi_s sve_cmpgt_ppzi_s sve_cmpge_ppzi_s sve_cmplt_ppzi_s sve_cmple_ppzi_s sve_cmphs_ppzi_s sve_cmphi_ppzi_s sve_cmplo_ppzi_s sve_cmpls_ppzi_s sve_cmpeq_ppzi_d sve_cmpne_ppzi_d sve_cmpgt_ppzi_d sve_cmpge_ppzi_d sve_cmplt_ppzi_d sve_cmple_ppzi_d sve_cmphs_ppzi_d sve_cmphi_ppzi_d sve_cmplo_ppzi_d sve_cmpls_ppzi_d sve_and_pppp sve_bic_pppp sve_eor_pppp sve_sel_pppp sve_orr_pppp sve_orn_pppp sve_nor_pppp sve_nand_pppp sve_brkpa sve_brkpb sve_brkpas sve_brkpbs sve_brka_z sve_brkb_z sve_brka_m sve_brkb_m sve_brkas_z sve_brkbs_z sve_brkas_m sve_brkbs_m sve_brkn sve_brkns sve_cntp sve_while sve_subri_b sve_subri_h sve_subri_s sve_subri_d sve_smaxi_b sve_smaxi_h sve_smaxi_s sve_smaxi_d sve_smini_b sve_smini_h sve_smini_s sve_smini_d sve_umaxi_b sve_umaxi_h sve_umaxi_s sve_umaxi_d sve_umini_b sve_umini_h sve_umini_s sve_umini_d gvec_recps_h gvec_recps_s gvec_recps_d gvec_rsqrts_h gvec_rsqrts_s gvec_rsqrts_d sve_faddv_h sve_faddv_s sve_faddv_d sve_fmaxnmv_h sve_fmaxnmv_s sve_fmaxnmv_d sve_fminnmv_h sve_fminnmv_s sve_fminnmv_d sve_fmaxv_h sve_fmaxv_s sve_fmaxv_d sve_fminv_h sve_fminv_s sve_fminv_d sve_fadda_h sve_fadda_s sve_fadda_d sve_fcmge0_h sve_fcmge0_s sve_fcmge0_d sve_fcmgt0_h sve_fcmgt0_s sve_fcmgt0_d sve_fcmlt0_h sve_fcmlt0_s sve_fcmlt0_d sve_fcmle0_h sve_fcmle0_s sve_fcmle0_d sve_fcmeq0_h sve_fcmeq0_s sve_fcmeq0_d sve_fcmne0_h sve_fcmne0_s sve_fcmne0_d sve_fadd_h sve_fadd_s sve_fadd_d sve_fsub_h sve_fsub_s sve_fsub_d sve_fmul_h sve_fmul_s sve_fmul_d sve_fdiv_h sve_fdiv_s sve_fdiv_d sve_fmin_h sve_fmin_s sve_fmin_d sve_fmax_h sve_fmax_s sve_fmax_d sve_fminnum_h sve_fminnum_s sve_fminnum_d sve_fmaxnum_h sve_fmaxnum_s sve_fmaxnum_d sve_fabd_h sve_fabd_s sve_fabd_d sve_fscalbn_h sve_fscalbn_s sve_fscalbn_d sve_fmulx_h sve_fmulx_s sve_fmulx_d sve_fadds_h sve_fadds_s sve_fadds_d sve_fsubs_h sve_fsubs_s sve_fsubs_d sve_fmuls_h sve_fmuls_s sve_fmuls_d sve_fsubrs_h sve_fsubrs_s sve_fsubrs_d sve_fmaxnms_h sve_fmaxnms_s sve_fmaxnms_d sve_fminnms_h sve_fminnms_s sve_fminnms_d sve_fmaxs_h sve_fmaxs_s sve_fmaxs_d sve_fmins_h sve_fmins_s sve_fmins_d sve_fcvt_sh sve_fcvt_dh sve_fcvt_hs sve_fcvt_ds sve_fcvt_hd sve_fcvt_sd sve_fcvtzs_hh sve_fcvtzs_hs sve_fcvtzs_ss sve_fcvtzs_ds sve_fcvtzs_hd sve_fcvtzs_sd sve_fcvtzs_dd sve_fcvtzu_hh sve_fcvtzu_hs sve_fcvtzu_ss sve_fcvtzu_ds sve_fcvtzu_hd sve_fcvtzu_sd sve_fcvtzu_dd sve_frint_h sve_frint_s sve_frint_d sve_frintx_h sve_frintx_s sve_frintx_d sve_frecpx_h sve_frecpx_s sve_frecpx_d sve_fsqrt_h sve_fsqrt_s sve_fsqrt_d sve_scvt_hh sve_scvt_sh sve_scvt_dh sve_scvt_ss sve_scvt_sd sve_scvt_ds sve_scvt_dd sve_ucvt_hh sve_ucvt_sh sve_ucvt_dh sve_ucvt_ss sve_ucvt_sd sve_ucvt_ds sve_ucvt_dd sve_fcmge_h sve_fcmge_s sve_fcmge_d sve_fcmgt_h sve_fcmgt_s sve_fcmgt_d sve_fcmeq_h sve_fcmeq_s sve_fcmeq_d sve_fcmne_h sve_fcmne_s sve_fcmne_d sve_fcmuo_h sve_fcmuo_s sve_fcmuo_d sve_facge_h sve_facge_s sve_facge_d sve_facgt_h sve_facgt_s sve_facgt_d sve_fcadd_h sve_fcadd_s sve_fcadd_d sve_fmla_zpzzz_h sve_fmla_zpzzz_s sve_fmla_zpzzz_d sve_fmls_zpzzz_h sve_fmls_zpzzz_s sve_fmls_zpzzz_d sve_fnmla_zpzzz_h sve_fnmla_zpzzz_s sve_fnmla_zpzzz_d sve_fnmls_zpzzz_h sve_fnmls_zpzzz_s sve_fnmls_zpzzz_d sve_fcmla_zpzzz_h sve_fcmla_zpzzz_s sve_fcmla_zpzzz_d sve_ftmad_h sve_ftmad_s sve_ftmad_d sve_ld1bb_r sve_ld2bb_r sve_ld3bb_r sve_ld4bb_r sve_ld1hh_le_r sve_ld2hh_le_r sve_ld3hh_le_r sve_ld4hh_le_r sve_ld1hh_be_r sve_ld2hh_be_r sve_ld3hh_be_r sve_ld4hh_be_r sve_ld1ss_le_r sve_ld2ss_le_r sve_ld3ss_le_r sve_ld4ss_le_r sve_ld1ss_be_r sve_ld2ss_be_r sve_ld3ss_be_r sve_ld4ss_be_r sve_ld1dd_le_r sve_ld2dd_le_r sve_ld3dd_le_r sve_ld4dd_le_r sve_ld1dd_be_r sve_ld2dd_be_r sve_ld3dd_be_r sve_ld4dd_be_r sve_ld1bhu_r sve_ld1bsu_r sve_ld1bdu_r sve_ld1bhs_r sve_ld1bss_r sve_ld1bds_r sve_ld1hsu_le_r sve_ld1hdu_le_r sve_ld1hss_le_r sve_ld1hds_le_r sve_ld1hsu_be_r sve_ld1hdu_be_r sve_ld1hss_be_r sve_ld1hds_be_r sve_ld1sdu_le_r sve_ld1sds_le_r sve_ld1sdu_be_r sve_ld1sds_be_r sve_ldff1bb_r sve_ldff1bhu_r sve_ldff1bsu_r sve_ldff1bdu_r sve_ldff1bhs_r sve_ldff1bss_r sve_ldff1bds_r sve_ldff1hh_le_r sve_ldff1hsu_le_r sve_ldff1hdu_le_r sve_ldff1hss_le_r sve_ldff1hds_le_r sve_ldff1hh_be_r sve_ldff1hsu_be_r sve_ldff1hdu_be_r sve_ldff1hss_be_r sve_ldff1hds_be_r sve_ldff1ss_le_r sve_ldff1sdu_le_r sve_ldff1sds_le_r sve_ldff1ss_be_r sve_ldff1sdu_be_r sve_ldff1sds_be_r sve_ldff1dd_le_r sve_ldff1dd_be_r sve_ldnf1bb_r sve_ldnf1bhu_r sve_ldnf1bsu_r sve_ldnf1bdu_r sve_ldnf1bhs_r sve_ldnf1bss_r sve_ldnf1bds_r sve_ldnf1hh_le_r sve_ldnf1hsu_le_r sve_ldnf1hdu_le_r sve_ldnf1hss_le_r sve_ldnf1hds_le_r sve_ldnf1hh_be_r sve_ldnf1hsu_be_r sve_ldnf1hdu_be_r sve_ldnf1hss_be_r sve_ldnf1hds_be_r sve_ldnf1ss_le_r sve_ldnf1sdu_le_r sve_ldnf1sds_le_r sve_ldnf1ss_be_r sve_ldnf1sdu_be_r sve_ldnf1sds_be_r sve_ldnf1dd_le_r sve_ldnf1dd_be_r sve_st1bb_r sve_st2bb_r sve_st3bb_r sve_st4bb_r sve_st1hh_le_r sve_st2hh_le_r sve_st3hh_le_r sve_st4hh_le_r sve_st1hh_be_r sve_st2hh_be_r sve_st3hh_be_r sve_st4hh_be_r sve_st1ss_le_r sve_st2ss_le_r sve_st3ss_le_r sve_st4ss_le_r sve_st1ss_be_r sve_st2ss_be_r sve_st3ss_be_r sve_st4ss_be_r sve_st1dd_le_r sve_st2dd_le_r sve_st3dd_le_r sve_st4dd_le_r sve_st1dd_be_r sve_st2dd_be_r sve_st3dd_be_r sve_st4dd_be_r sve_st1bh_r sve_st1bs_r sve_st1bd_r sve_st1hs_le_r sve_st1hd_le_r sve_st1hs_be_r sve_st1hd_be_r sve_st1sd_le_r sve_st1sd_be_r sve_ldbsu_zsu sve_ldhsu_le_zsu sve_ldhsu_be_zsu sve_ldss_le_zsu sve_ldss_be_zsu sve_ldbss_zsu sve_ldhss_le_zsu sve_ldhss_be_zsu sve_ldbsu_zss sve_ldhsu_le_zss sve_ldhsu_be_zss sve_ldss_le_zss sve_ldss_be_zss sve_ldbss_zss sve_ldhss_le_zss sve_ldhss_be_zss sve_ldbdu_zsu sve_ldhdu_le_zsu sve_ldhdu_be_zsu sve_ldsdu_le_zsu sve_ldsdu_be_zsu sve_lddd_le_zsu sve_lddd_be_zsu sve_ldbds_zsu sve_ldhds_le_zsu sve_ldhds_be_zsu sve_ldsds_le_zsu sve_ldsds_be_zsu sve_ldbdu_zss sve_ldhdu_le_zss sve_ldhdu_be_zss sve_ldsdu_le_zss sve_ldsdu_be_zss sve_lddd_le_zss sve_lddd_be_zss sve_ldbds_zss sve_ldhds_le_zss sve_ldhds_be_zss sve_ldsds_le_zss sve_ldsds_be_zss sve_ldbdu_zd sve_ldhdu_le_zd sve_ldhdu_be_zd sve_ldsdu_le_zd sve_ldsdu_be_zd sve_lddd_le_zd sve_lddd_be_zd sve_ldbds_zd sve_ldhds_le_zd sve_ldhds_be_zd sve_ldsds_le_zd sve_ldsds_be_zd sve_ldffbsu_zsu sve_ldffhsu_le_zsu sve_ldffhsu_be_zsu sve_ldffss_le_zsu sve_ldffss_be_zsu sve_ldffbss_zsu sve_ldffhss_le_zsu sve_ldffhss_be_zsu sve_ldffbsu_zss sve_ldffhsu_le_zss sve_ldffhsu_be_zss sve_ldffss_le_zss sve_ldffss_be_zss sve_ldffbss_zss sve_ldffhss_le_zss sve_ldffhss_be_zss sve_ldffbdu_zsu sve_ldffhdu_le_zsu sve_ldffhdu_be_zsu sve_ldffsdu_le_zsu sve_ldffsdu_be_zsu sve_ldffdd_le_zsu sve_ldffdd_be_zsu sve_ldffbds_zsu sve_ldffhds_le_zsu sve_ldffhds_be_zsu sve_ldffsds_le_zsu sve_ldffsds_be_zsu sve_ldffbdu_zss sve_ldffhdu_le_zss sve_ldffhdu_be_zss sve_ldffsdu_le_zss sve_ldffsdu_be_zss sve_ldffdd_le_zss sve_ldffdd_be_zss sve_ldffbds_zss sve_ldffhds_le_zss sve_ldffhds_be_zss sve_ldffsds_le_zss sve_ldffsds_be_zss sve_ldffbdu_zd sve_ldffhdu_le_zd sve_ldffhdu_be_zd sve_ldffsdu_le_zd sve_ldffsdu_be_zd sve_ldffdd_le_zd sve_ldffdd_be_zd sve_ldffbds_zd sve_ldffhds_le_zd sve_ldffhds_be_zd sve_ldffsds_le_zd sve_ldffsds_be_zd sve_stbs_zsu sve_sths_le_zsu sve_sths_be_zsu sve_stss_le_zsu sve_stss_be_zsu sve_stbs_zss sve_sths_le_zss sve_sths_be_zss sve_stss_le_zss sve_stss_be_zss sve_stbd_zsu sve_sthd_le_zsu sve_sthd_be_zsu sve_stsd_le_zsu sve_stsd_be_zsu sve_stdd_le_zsu sve_stdd_be_zsu sve_stbd_zss sve_sthd_le_zss sve_sthd_be_zss sve_stsd_le_zss sve_stsd_be_zss sve_stdd_le_zss sve_stdd_be_zss sve_stbd_zd sve_sthd_le_zd sve_sthd_be_zd sve_stsd_le_zd sve_stsd_be_zd sve_stdd_le_zd sve_stdd_be_zd trace_guest_mem_before_exec_proxy div_i32 rem_i32 divu_i32 remu_i32 div_i64 rem_i64 divu_i64 remu_i64 shl_i64 shr_i64 sar_i64 mulsh_i64 muluh_i64 clz_i32 ctz_i32 clz_i64 ctz_i64 clrsb_i32 clrsb_i64 ctpop_i32 ctpop_i64 lookup_tb_ptr exit_atomic atomic_cmpxchgb atomic_cmpxchgw_be atomic_cmpxchgw_le atomic_cmpxchgl_be atomic_cmpxchgl_le atomic_cmpxchgq_be atomic_cmpxchgq_le atomic_fetch_addb atomic_fetch_addw_le atomic_fetch_addw_be atomic_fetch_addl_le atomic_fetch_addl_be atomic_fetch_addq_le atomic_fetch_addq_be atomic_fetch_andb atomic_fetch_andw_le atomic_fetch_andw_be atomic_fetch_andl_le atomic_fetch_andl_be atomic_fetch_andq_le atomic_fetch_andq_be atomic_fetch_orb atomic_fetch_orw_le atomic_fetch_orw_be atomic_fetch_orl_le atomic_fetch_orl_be atomic_fetch_orq_le atomic_fetch_orq_be atomic_fetch_xorb atomic_fetch_xorw_le atomic_fetch_xorw_be atomic_fetch_xorl_le atomic_fetch_xorl_be atomic_fetch_xorq_le atomic_fetch_xorq_be atomic_fetch_sminb atomic_fetch_sminw_le atomic_fetch_sminw_be atomic_fetch_sminl_le atomic_fetch_sminl_be atomic_fetch_sminq_le atomic_fetch_sminq_be atomic_fetch_uminb atomic_fetch_uminw_le atomic_fetch_uminw_be atomic_fetch_uminl_le atomic_fetch_uminl_be atomic_fetch_uminq_le atomic_fetch_uminq_be atomic_fetch_smaxb atomic_fetch_smaxw_le atomic_fetch_smaxw_be atomic_fetch_smaxl_le atomic_fetch_smaxl_be atomic_fetch_smaxq_le atomic_fetch_smaxq_be atomic_fetch_umaxb atomic_fetch_umaxw_le atomic_fetch_umaxw_be atomic_fetch_umaxl_le atomic_fetch_umaxl_be atomic_fetch_umaxq_le atomic_fetch_umaxq_be atomic_add_fetchb atomic_add_fetchw_le atomic_add_fetchw_be atomic_add_fetchl_le atomic_add_fetchl_be atomic_add_fetchq_le atomic_add_fetchq_be atomic_and_fetchb atomic_and_fetchw_le atomic_and_fetchw_be atomic_and_fetchl_le atomic_and_fetchl_be atomic_and_fetchq_le atomic_and_fetchq_be atomic_or_fetchb atomic_or_fetchw_le atomic_or_fetchw_be atomic_or_fetchl_le atomic_or_fetchl_be atomic_or_fetchq_le atomic_or_fetchq_be atomic_xor_fetchb atomic_xor_fetchw_le atomic_xor_fetchw_be atomic_xor_fetchl_le atomic_xor_fetchl_be atomic_xor_fetchq_le atomic_xor_fetchq_be atomic_smin_fetchb atomic_smin_fetchw_le atomic_smin_fetchw_be atomic_smin_fetchl_le atomic_smin_fetchl_be atomic_smin_fetchq_le atomic_smin_fetchq_be atomic_umin_fetchb atomic_umin_fetchw_le atomic_umin_fetchw_be atomic_umin_fetchl_le atomic_umin_fetchl_be atomic_umin_fetchq_le atomic_umin_fetchq_be atomic_smax_fetchb atomic_smax_fetchw_le atomic_smax_fetchw_be atomic_smax_fetchl_le atomic_smax_fetchl_be atomic_smax_fetchq_le atomic_smax_fetchq_be atomic_umax_fetchb atomic_umax_fetchw_le atomic_umax_fetchw_be atomic_umax_fetchl_le atomic_umax_fetchl_be atomic_umax_fetchq_le atomic_umax_fetchq_be atomic_xchgb atomic_xchgw_le atomic_xchgw_be atomic_xchgl_le atomic_xchgl_be atomic_xchgq_le atomic_xchgq_be gvec_mov gvec_dup8 gvec_dup16 gvec_dup32 gvec_dup64 gvec_add8 gvec_add16 gvec_add32 gvec_add64 gvec_adds8 gvec_adds16 gvec_adds32 gvec_adds64 gvec_sub8 gvec_sub16 gvec_sub32 gvec_sub64 gvec_subs8 gvec_subs16 gvec_subs32 gvec_subs64 gvec_mul8 gvec_mul16 gvec_mul32 gvec_mul64 gvec_muls8 gvec_muls16 gvec_muls32 gvec_muls64 gvec_ssadd8 gvec_ssadd16 gvec_ssadd32 gvec_ssadd64 gvec_sssub8 gvec_sssub16 gvec_sssub32 gvec_sssub64 gvec_usadd8 gvec_usadd16 gvec_usadd32 gvec_usadd64 gvec_ussub8 gvec_ussub16 gvec_ussub32 gvec_ussub64 gvec_smin8 gvec_smin16 gvec_smin32 gvec_smin64 gvec_smax8 gvec_smax16 gvec_smax32 gvec_smax64 gvec_umin8 gvec_umin16 gvec_umin32 gvec_umin64 gvec_umax8 gvec_umax16 gvec_umax32 gvec_umax64 gvec_neg8 gvec_neg16 gvec_neg32 gvec_neg64 gvec_abs8 gvec_abs16 gvec_abs32 gvec_abs64 gvec_not gvec_and gvec_or gvec_xor gvec_andc gvec_orc gvec_nand gvec_nor gvec_eqv gvec_ands gvec_xors gvec_ors gvec_shl8i gvec_shl16i gvec_shl32i gvec_shl64i gvec_shr8i gvec_shr16i gvec_shr32i gvec_shr64i gvec_sar8i gvec_sar16i gvec_sar32i gvec_sar64i gvec_shl8v gvec_shl16v gvec_shl32v gvec_shl64v gvec_shr8v gvec_shr16v gvec_shr32v gvec_shr64v gvec_sar8v gvec_sar16v gvec_sar32v gvec_sar64v gvec_eq8 gvec_eq16 gvec_eq32 gvec_eq64 gvec_ne8 gvec_ne16 gvec_ne32 gvec_ne64 gvec_lt8 gvec_lt16 gvec_lt32 gvec_lt64 gvec_le8 gvec_le16 gvec_le32 gvec_le64 gvec_ltu8 gvec_ltu16 gvec_ltu32 gvec_ltu64 gvec_leu8 gvec_leu16 gvec_leu32 gvec_leu64 gvec_bitsel

all: $(UTILBINS) $(TOOLBINS) $(JOVE_RT) $(BINDIR)/jove.bc $(foreach helper,$($(ARCH)_HELPERS),$(BINDIR)/$(helper).bc)

define build_tool_template
$(BINDIR)/$(1): $(TOOLSRCDIR)/$(1).cpp
	@echo CXX $(1)
	@$(_LLVM_CXX) -o $$@ -pipe -MMD $(CXXFLAGS) $$< $(LDFLAGS)
endef
$(foreach tool,$(TOOLS),$(eval $(call build_tool_template,$(tool))))

define build_util_template
$(BINDIR)/$(1): $(UTILSRCDIR)/$(1).cpp
	@echo CXX $(1)
	@$(_LLVM_CXX) -o $$@ -pipe -MMD $(CXXFLAGS) $$< $(LDFLAGS)
endef
$(foreach util,$(UTILS),$(eval $(call build_util_template,$(util))))

$(BINDIR)/jove-add: $(BINDIR)/jove/tcgconstants.h
$(BINDIR)/jove-dyn: $(BINDIR)/jove/tcgconstants.h
$(BINDIR)/jove-llvm: $(BINDIR)/jove/tcgconstants.h
$(BINDIR)/jove-recover: $(BINDIR)/jove/tcgconstants.h
$(BINDIR)/jove-recompile: $(BINDIR)/jove/tcgconstants.h
$(BINDIR)/jove-readtrace: $(BINDIR)/jove/tcgconstants.h
$(BINDIR)/jove-init: $(BINDIR)/jove/tcgconstants.h
$(BINDIR)/jove-dump: $(BINDIR)/jove/tcgconstants.h
$(BINDIR)/tcgglobals: $(BINDIR)/jove/tcgconstants.h
$(BINDIR)/jove-extract: $(BINDIR)/jove/tcgconstants.h
$(BINDIR)/tcgdump: $(BINDIR)/jove/tcgconstants.h
$(BINDIR)/jove-trace2lines: $(BINDIR)/jove/tcgconstants.h
$(BINDIR)/jv2xml: $(BINDIR)/jove/tcgconstants.h
$(BINDIR)/jove-trace: $(BINDIR)/jove/tcgconstants.h

$(BINDIR)/jove/tcgconstants.h: $(BINDIR)/gen-tcgconstants
	@mkdir -p $(BINDIR)/jove
	@echo GEN $@
	@$< > $@

$(JOVE_RT): lib/arch/$(ARCH)/rt.c
	@echo CC $<
	@$(_LLVM_CC) -o $@ -shared -Wl,-soname=$(JOVE_RT_SONAME) -nostdlib -Ofast -ffreestanding -fno-stack-protector -fPIC -g -Wall $<
	@ln -sf $(JOVE_RT_SONAME) $(BINDIR)/$(JOVE_RT_SO)

$(BINDIR)/jove.bc: lib/arch/$(ARCH)/jove.c
	@echo CC $<
	@$(_LLVM_CC) -o $@ -c -emit-llvm -I lib -Ofast -ffreestanding -fno-stack-protector -fPIC -g -Wall $<

-include $(TOOLDEPS)
-include $(UTILDEPS)

.PHONY: clean
clean:
	rm -rf $(TOOLBINS) $(UTILBINS) $(TOOLDEPS) $(UTILDEPS) $(BINDIR)/jove $(BINDIR)/*.bc

#
# for extricating QEMU code
#

CLANG_EXTRICATE := ~/clang-extricate
QEMU_SRC_DIR    := ~/qemu
QEMU_BUILD_DIR  := ~/qemu

_SL_TCG_GEN_ADDI_I64 := tcg/tcg-op.c:1243l
_SL_TCG_OPTIMIZE     := tcg/optimize.c:599l
_SL_TCG_OP_DEFS      := tcg/tcg-common.c:35l
_SL_TB_GEN_CODE      := accel/tcg/translate-all.c:1667l
_SL_TRANSLATOR_LOOP  := accel/tcg/translator.c:36l
_SL_PSTRCPY          := util/cutils.c:45l

COMMON_SOURCE_LOCATIONS := $(_SL_TCG_GEN_ADDI_I64) \
                           $(_SL_TCG_OPTIMIZE) \
                           $(_SL_TCG_OP_DEFS) \
                           $(_SL_TB_GEN_CODE) \
                           $(_SL_TRANSLATOR_LOOP) \
                           $(_SL_PSTRCPY)

_SL_X86_64_TCG_CONTEXT_INIT := tcg/tcg.c:2070l
_SL_X86_64_TCG_FUNC_START   := tcg/tcg.c:2256l
_SL_X86_64_TCG_GEN_CODE     := tcg/tcg.c:4633l

_SL_X86_64_GEN_INTERMEDIATE_CODE  := target/i386/translate.c:8573l
_SL_X86_64_TCG_X86_INIT           := target/i386/translate.c:8328l
# _SL_X86_64_TCG_GEN_GVEC_NOT       := tcg/tcg-op-gvec.c:1357l
# _SL_X86_64_TCG_GEN_LD_VEC         := tcg/tcg-op-vec.c:209l

x86_64_SOURCE_LOCATIONS := $(_SL_X86_64_TCG_CONTEXT_INIT) \
                           $(_SL_X86_64_TCG_FUNC_START) \
                           $(_SL_X86_64_TCG_GEN_CODE) \
                           $(_SL_X86_64_GEN_INTERMEDIATE_CODE) \
                           $(_SL_X86_64_TCG_X86_INIT)

i386_SOURCE_LOCATIONS := $(_SL_X86_64_TCG_CONTEXT_INIT) \
                         $(_SL_X86_64_TCG_FUNC_START) \
                         $(_SL_X86_64_TCG_GEN_CODE) \
                         $(_SL_X86_64_GEN_INTERMEDIATE_CODE) \
                         $(_SL_X86_64_TCG_X86_INIT)

x86_64_HELPER_CFLAGS := -DCONFIG_ATOMIC64=1 \
                        -DCONFIG_USER_ONLY=1

#                           $(_SL_X86_64_TCG_GEN_GVEC_NOT) \
#                           $(_SL_X86_64_TCG_GEN_LD_VEC)

_SL_AARCH64_TCG_CONTEXT_INIT := tcg/tcg.c:3844l
_SL_AARCH64_TCG_FUNC_START   := tcg/tcg.c:4034l
_SL_AARCH64_TCG_GEN_CODE     := tcg/tcg.c:6924l

_SL_AARCH64_GEN_INTERMEDIATE_CODE := target/arm/translate.c:14082l
_SL_AARCH64_TRANSLATOR_OPS        := target/arm/translate-a64.c:14354l
_SL_AARCH64_TRANSLATE_INIT        := target/arm/translate.c:85l
_SL_AARCH64_TCG_GEN_GVEC_NOT      := tcg/tcg-op-gvec.c:1542l
_SL_AARCH64_TCG_GEN_LD_VEC        := tcg/tcg-op-vec.c:338l
_SL_AARCH64_TCG_DISAS_SVE         := target/arm/translate-sve.c:1913l

aarch64_SOURCE_LOCATIONS := $(_SL_AARCH64_TCG_CONTEXT_INIT) \
                            $(_SL_AARCH64_TCG_FUNC_START) \
                            $(_SL_AARCH64_TCG_GEN_CODE) \
                            $(_SL_AARCH64_GEN_INTERMEDIATE_CODE) \
                            $(_SL_AARCH64_TRANSLATOR_OPS) \
                            $(_SL_AARCH64_TRANSLATE_INIT) \
                            $(_SL_AARCH64_TCG_GEN_GVEC_NOT) \
                            $(_SL_AARCH64_TCG_GEN_LD_VEC) \
                            $(_SL_AARCH64_TCG_DISAS_SVE)

.PHONY: extract-tcg-code
extract-tcg-code:
	$(CLANG_EXTRICATE)/extract/bin/carbon-extract --src $(QEMU_SRC_DIR) --bin $(QEMU_BUILD_DIR) $(COMMON_SOURCE_LOCATIONS) $($(ARCH)_SOURCE_LOCATIONS) > lib/arch/$(ARCH)/tcg.hpp

#
# TCG helpers
#
.PHONY: extract-helpers
extract-helpers: $(foreach helper,$($(ARCH)_HELPERS),extract-$(helper))

define extract_helper_template
.PHONY: extract-$(1)
extract-$(1):
	-$(CLANG_EXTRICATE)/extract/bin/carbon-extract --src $(QEMU_SRC_DIR) --bin $(QEMU_BUILD_DIR) helper_$(1) > lib/arch/$(ARCH)/helpers/$(1).c
endef
$(foreach helper,$($(ARCH)_HELPERS),$(eval $(call extract_helper_template,$(helper))))

define build_helper_template
$(BINDIR)/$(1).bc: lib/arch/$(ARCH)/helpers/$(1).c Makefile
	@echo CC $$<
	@$(_LLVM_CC) -o $$@ -c -I lib -I lib/arch/$(ARCH) -emit-llvm -fPIC -g -Ofast -ffreestanding -fno-stack-protector -Wall -Wno-macro-redefined -Wno-initializer-overrides -fno-strict-aliasing -fno-common -fwrapv $($(ARCH)_HELPER_CFLAGS) $$<
endef
$(foreach helper,$($(ARCH)_HELPERS),$(eval $(call build_helper_template,$(helper))))

.PHONY: check-helpers
check-helpers: $(foreach helper,$($(ARCH)_HELPERS),check-$(helper))

define check_helper_template
.PHONY: check-$(1)
check-$(1): $(BINDIR)/$(1).bc $(BINDIR)/check-helper
	-$(BINDIR)/check-helper $(1)
endef
$(foreach helper,$($(ARCH)_HELPERS),$(eval $(call check_helper_template,$(helper))))

#
# qemu configure command
#
# ./configure --target-list=x86_64-linux-user --cc=clang --host-cc=clang --cxx=clang++ --objcc=clang --disable-tcg-interpreter --disable-sdl --disable-gtk --disable-xen --disable-bluez --disable-kvm --disable-guest-agent --disable-vnc --disable-libssh2 --disable-jemalloc --disable-tcmalloc --disable-vhost-user --disable-opengl --disable-glusterfs --disable-gnutls --disable-nettle --disable-gcrypt --disable-curses --disable-libnfs --disable-libusb --disable-lzo --disable-bzip2 --disable-vhost-vsock --disable-smartcard --disable-usb-redir --disable-spice --disable-vhost-net --disable-snappy --disable-seccomp --disable-vhost-scsi --disable-virglrenderer --disable-vde --disable-rbd --disable-live-block-migration --disable-tools --disable-tpm --disable-numa --disable-cap-ng --disable-replication --disable-vte --disable-qom-cast-debug --disable-tpm --disable-xfsctl --disable-linux-aio --disable-attr --disable-coroutine-pool --disable-hax --enable-trace-backends=nop --disable-libxml2 --disable-vhost-crypto --disable-capstone --extra-cflags="-Xclang -load -Xclang $HOME/clang-extricate/collect/bin/carbon-collect.so -Xclang -add-plugin -Xclang carbon-collect -Xclang -plugin-arg-carbon-collect -Xclang $(pwd) -Xclang -plugin-arg-carbon-collect -Xclang $(pwd)"
